# -*- mode: ruby -*-
# vi: set ft=ruby :
Vagrant.configure("2") do |config| 
  config.vm.define "SIFT" do |sift|
    sift.vm.box = "ubuntu/jammy64"
    sift.vm.provider "virtualbox" do |vb|
      vb.memory = 2048
      vb.cpus = 2
      vb.customize ['modifyvm', :id, '--clipboard', 'bidirectional']
    end

    sift.vm.provision "shell", inline: <<-EOF
      sudo apt update
      sudo apt install ubuntu-desktop --install-recommends -y
      sudo apt install build-essential linux-headers-$(uname -r) dkms -y
      sudo apt install -y crowbar ansible git python3-pip
      sudo apt update && apt upgrade -y 
      sudo wget https://github.com/ekristen/cast/releases/download/v0.14.0/cast_v0.14.0_linux_amd64.deb && sudo dpkg -i cast_v0.14.0_linux_amd64.deb
      sudo cast install teamdfir/sift-saltstack
      sudo localectl set-x11-keymap fr
    EOF

    sift.vm.provision "ansible" do |ansible|
      ansible.playbook = "sift_playbook.yml"
    end
  end


  config.vm.define "Remnux" do |remnux|
    remnux.vm.box = "ubuntu/focal64"
    remnux.vm.provider "virtualbox" do |vb|
      vb.memory = 2048
      vb.cpus = 2
      vb.customize ['modifyvm', :id, '--clipboard', 'bidirectional']
    end

    remnux.vm.provision "shell", inline: <<-EOF
      sudo apt update
      sudo apt install ubuntu-desktop --install-recommends -y
      sudo apt install build-essential linux-headers-$(uname -r) dkms -y
      sudo apt install -y crowbar ansible git python3-pip 
      sudo apt update && sudo apt upgrade -y 
      sudo wget https://github.com/ekristen/cast/releases/download/v0.14.0/cast_v0.14.0_linux_amd64.deb && sudo dpkg -i cast_v0.14.0_linux_amd64.deb
      sudo cast install remnux/salt-states
      sudo localectl set-x11-keymap fr
    EOF

    remnux.vm.provision "ansible" do |ansible|
      ansible.playbook = "remnux_playbook.yml"
    end
  end
end